version: "3"

services:
    cloudfeeds:
        image: docker.ciidentity.com/cloud-feeds
        ports:
            - "8888:8080"
        environment:
            HOST: localhost:8888

    edir:
        image: docker.ciidentity.com/e-directory
        ports:
            - "20636:636"
            - "10389:389"
        volumes:
            - ../edir/config:/config
            - ../edir/ldif:/data

    directory:
        image: docker.ciidentity.com/ca-directory
        ports:
            - "10636:10636"
        volumes:
            - ../ldap/config:/config
            - ../ldap/ldif:/data

    identity:
        image: docker.ciidentity.com/cloud-identity
        ports:
            - "8083:8080"
        environment:
            EDIRECTORY_PORT: 636
        links:
            - cloudfeeds
            - edir
            - directory
        volumes:
            - ../build/libs:/opt/idm/artifacts
            - .identity/configs:/etc/idm/config
            - ../src/test/resources/keys:/etc/idm/config/keys

    repose:
        image: docker.ciidentity.com/repose:8.7.1.0
        ports:
            - "8080:8080"
        links:
            - identity
        volumes:
            - ../repose/config:/etc/repose
